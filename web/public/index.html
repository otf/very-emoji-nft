<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="dist/elm.compiled.js"></script>
  <title>Very Emoji</title>
</head>
<body>
  <div id="app"></div>
  <script type="module">
    import { txSentry, walletSentry } from './elm-ethereum-ports.js';

    if (window.ethereum) {
        handleEthereum();
    } else {
        window.addEventListener('ethereum#initialized', handleEthereum, {
            once: true,
        });

        // if the event is not dispatched by the end of the timeout,
        // the user probably dowsn't have MetaMask installed.
        setTimeout(handleEthereum, 3000); // 3 seconds
    }

    function handleEthereum() {
        const { ethereum } = window;
        if (ethereum && ethereum.isMetaMask) {
            console.log('Ethereum successfully detected!');
            const networkId = ethereum.chainId;
            const app = Elm.Main.init({
              flags: parseInt(networkId),
              node: document.getElementById('app')
            });
            txSentry(app.ports.txOut, app.ports.txIn, ethereum);
            walletSentry(app.ports.walletSentry, ethereum);
            app.ports.connectWallet.subscribe(function (){
              ethereum.request({ method: 'eth_requestAccounts' });
            });
        } else {
            console.log('Please install MetaMask!');
            const app = Elm.Main.init({
              flags: -1,
              node: document.getElementById('app')
            });
        }
    }
  </script>
</body>
</html>
